{"ast":null,"code":"import _regeneratorRuntime from\"/home/ranju/location/meDossier/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/ranju/location/meDossier/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/ranju/location/meDossier/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/ranju/location/meDossier/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Switch,Route,Router}from\"react-router-dom\";import Register from'./home';import getWeb3 from'../getWeb3';import history from'./history';import Patient from'./patients_dashboard';import DocDashboard from'./doctor_dashboard';import{CONTRACT_ADDRESS,ABI}from\"../config.js\";import Verifier from\"./registrer_dashboard\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Render(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),currentAccount=_useState2[0],setCurrentAccount=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),contract=_useState4[0],setContract=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var getWeb3Data=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,accounts,instance;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getWeb3();case 3:web3=_context.sent;_context.next=6;return web3.eth.getAccounts();case 6:accounts=_context.sent;console.log(accounts);//initialize contract\n_context.next=10;return new web3.eth.Contract(ABI,CONTRACT_ADDRESS);case 10:instance=_context.sent;setCurrentAccount(accounts[0]);setContract(_objectSpread({},instance));_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);alert(\"Cannot load web3 ,contract. Consult console for details\");console.log(_context.t0);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return function getWeb3Data(){return _ref.apply(this,arguments);};}();//Register Patient\nvar patientRegister=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(name,phone,gender,dob,blood){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;console.log(name,phone,gender,dob,blood);console.log(currentAccount);_context2.next=5;return contract.methods.addPatient(name,phone,gender,dob,blood).send({from:currentAccount,gas:1000000});case 5:_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function patientRegister(_x,_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();//Register/Add Doctor\nvar doctorRegister=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(name,hname,contact,faculty,license){var result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;console.log(name,hname,contact,faculty);_context3.next=4;return contract.methods.addDoctor(name,hname,contact,faculty,license).send({from:currentAccount,gas:1000000});case 4:result=_context3.sent;_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return function doctorRegister(_x6,_x7,_x8,_x9,_x10){return _ref3.apply(this,arguments);};}();//Handle  patient Login\nvar handlelogin=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var result,registered,doctor,patient;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:localStorage.setItem('currentAccount',currentAccount);_context4.next=3;return contract.methods.user(currentAccount).call({from:currentAccount});case 3:result=_context4.sent;console.log(result);if(!(result==0)){_context4.next=39;break;}_context4.prev=6;console.log(\"success\");_context4.next=10;return contract.methods.isRegistered(currentAccount).call({from:currentAccount});case 10:registered=_context4.sent;if(!registered){_context4.next=30;break;}_context4.next=14;return contract.methods.getDoctorByAddress(currentAccount).call({from:currentAccount});case 14:doctor=_context4.sent;if(!(doctor.isApproved==false)){_context4.next=18;break;}_context4.next=18;return contract.methods.doctorLogin().send({from:currentAccount,gas:1000000});case 18:// await contract.methods.doctorLogin().send({from:currentAccount,gas:1000000})\n// const doctor = await contract.methods.getDoctorByAddress(currentAccount).call({from:currentAccount});\nsetUser(doctor);localStorage.setItem('docname',doctor.name);localStorage.setItem('faculty',doctor.faculty);localStorage.setItem('contact',doctor.contact);localStorage.setItem('isApproved',doctor.isApproved);localStorage.setItem('license',doctor.licenseno);localStorage.setItem('hname',doctor.hname);localStorage.setItem('isdoctor','true');console.log(doctor);history.push('/doctor_dashboard');_context4.next=31;break;case 30:alert(\"Your License is not registered! Please register first to access meDossier.\");case 31:_context4.next=37;break;case 33:_context4.prev=33;_context4.t0=_context4[\"catch\"](6);console.error(_context4.t0);// alert(error)\nalert(\"No records found\");case 37:_context4.next=63;break;case 39:if(!(result==1)){_context4.next=62;break;}_context4.prev=40;console.log(\"sucess\");_context4.next=44;return contract.methods.getPatientDetails(currentAccount).call({from:currentAccount});case 44:patient=_context4.sent;setUser(patient);console.log(patient);// if(patient.length!==0){\n// getPatientRecord();\nlocalStorage.setItem('name',patient._name);localStorage.setItem('phone',patient._phone);localStorage.setItem('dob',patient._dob);localStorage.setItem('bloodgroup',patient._bloodgroup);localStorage.setItem('gender',patient._gender);// localStorage.setItem('ispatient','true')\nlocalStorage.setItem('ispatient',\"true\");// localStorage.setItem('hname',doctor.hname)\nhistory.push('/patient');// }\n_context4.next=60;break;case 56:_context4.prev=56;_context4.t1=_context4[\"catch\"](40);console.error(_context4.t1);// alert(error)\nalert(\"No records found\");case 60:_context4.next=63;break;case 62:if(result==2){localStorage.setItem('isUser','true');history.push('/registration');}else{alert(\"User not registered!\");}case 63:case\"end\":return _context4.stop();}}},_callee4,null,[[6,33],[40,56]]);}));return function handlelogin(){return _ref4.apply(this,arguments);};}();//Patient grant Access to doctor\nvar grantAccess=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(doctor){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return contract.methods.grantAccess(doctor).send({from:currentAccount,gas:1000000});case 3:_context5.next=8;break;case 5:_context5.prev=5;_context5.t0=_context5[\"catch\"](0);console.error(_context5.t0);case 8:case\"end\":return _context5.stop();}}},_callee5,null,[[0,5]]);}));return function grantAccess(_x11){return _ref5.apply(this,arguments);};}();//Patient revoke access from doctor\nvar revokeAccess=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(doctor){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;console.log(doctor);_context6.next=4;return contract.methods.revoke_access(doctor).send({from:currentAccount,gas:1000000});case 4:_context6.next=10;break;case 6:_context6.prev=6;_context6.t0=_context6[\"catch\"](0);console.error(_context6.t0);alert(_context6.t0);case 10:case\"end\":return _context6.stop();}}},_callee6,null,[[0,6]]);}));return function revokeAccess(_x12){return _ref6.apply(this,arguments);};}();var logout=function logout(){localStorage.clear();history.push('/');window.location.reload(false);};useEffect(function(){getWeb3Data();},[]);return/*#__PURE__*/ (// <div className =\"Main\">\n_jsx(Router,{history:history,children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",exact:true,children:/*#__PURE__*/_jsx(Register,{patientRegister:patientRegister,doctorRegister:doctorRegister,handlelogin:handlelogin})}),/*#__PURE__*/_jsx(Route,{path:\"/patient\",children:/*#__PURE__*/_jsx(Patient,{patient:user,grantAccess:grantAccess,revokeAccess:revokeAccess,logout:logout// getPatientRecord ={getPatientRecord}\n// records ={records}\n})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/doctor_dashboard\",children:/*#__PURE__*/_jsx(DocDashboard,{doctor:user,logout:logout,currentAccount:currentAccount})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/registration\",children:/*#__PURE__*/_jsx(Verifier,{owner:user,logout:logout})})]})})// </div>\n);}export default Render;","map":{"version":3,"sources":["/home/ranju/location/meDossier/frontend/src/pages/render.js"],"names":["React","useState","useEffect","Switch","Route","Router","Register","getWeb3","history","Patient","DocDashboard","CONTRACT_ADDRESS","ABI","Verifier","Render","currentAccount","setCurrentAccount","contract","setContract","user","setUser","getWeb3Data","web3","eth","getAccounts","accounts","console","log","Contract","instance","alert","patientRegister","name","phone","gender","dob","blood","methods","addPatient","send","from","gas","doctorRegister","hname","contact","faculty","license","addDoctor","result","handlelogin","localStorage","setItem","call","isRegistered","registered","getDoctorByAddress","doctor","isApproved","doctorLogin","licenseno","push","error","getPatientDetails","patient","_name","_phone","_dob","_bloodgroup","_gender","grantAccess","revokeAccess","revoke_access","logout","clear","window","location","reload"],"mappings":"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","sourcesContent":["import React,{useState ,useEffect} from \"react\";\nimport { Switch ,Route ,Router} from \"react-router-dom\";\nimport Register from './home';\nimport getWeb3 from '../getWeb3';\nimport history from './history';\nimport Patient from './patients_dashboard';\nimport DocDashboard from './doctor_dashboard';\nimport { CONTRACT_ADDRESS, ABI } from \"../config.js\";\nimport Verifier from \"./registrer_dashboard\";\n\n\nfunction Render() {\n  \n const[currentAccount,setCurrentAccount]= useState('');\n const[contract, setContract] = useState({});\n const[user,setUser] = useState([]);\n const getWeb3Data = async()=>{\n   try{\n      //obtain web3 from getWeb3\n      const web3 = await getWeb3();\n      //obtain the accounts\n      const accounts = await web3.eth.getAccounts();\n      console.log(accounts);\n//initialize contract\n      const instance = await new web3.eth.Contract(ABI, CONTRACT_ADDRESS);\n      setCurrentAccount(accounts[0]);\n      setContract({...instance});\n   }\n   catch(error){\n     alert(\"Cannot load web3 ,contract. Consult console for details\");\n     console.log(error);\n   }\n }\n  //Register Patient\n  const patientRegister = async(name,phone,gender,dob,blood)=>{\n    try{\n      console.log(name,phone,gender,dob,blood);\n      console.log(currentAccount);\n      await contract.methods.addPatient(name,phone,gender,dob,blood).send({from:currentAccount,gas:1000000});\n      // await getWeb3Data();\n    }\n    catch(error){\n      console.log(error);\n    }\n  }\n  //Register/Add Doctor\n  const doctorRegister = async(name,hname,contact,faculty,license)=>{\n    try{\n      console.log(name,hname,contact,faculty);\n      const result = await contract.methods.addDoctor(name,hname,contact,faculty,license).send({from:currentAccount,gas:1000000});\n      // await getWeb3Data();\n\n    }\ncatch(error){\n  console.log(error);\n}\n  }\n  //Handle  patient Login\n  const handlelogin = async()=>{\n    localStorage.setItem('currentAccount',currentAccount)\n    const result = await contract.methods.user(currentAccount).call({from:currentAccount});\n    console.log(result);\n    if(result==0){\n      try{\n        console.log(\"success\");\n        const registered = await contract.methods.isRegistered(currentAccount).call({from:currentAccount});\n        if(registered){\n          const doctor = await contract.methods.getDoctorByAddress(currentAccount).call({from:currentAccount});\nif(doctor.isApproved==false){\n  await contract.methods.doctorLogin().send({from:currentAccount,gas:1000000})\n\n}\n        \n        // await contract.methods.doctorLogin().send({from:currentAccount,gas:1000000})\n        // const doctor = await contract.methods.getDoctorByAddress(currentAccount).call({from:currentAccount});\n        setUser(doctor);\n        localStorage.setItem('docname',doctor.name)\n        localStorage.setItem('faculty',doctor.faculty)\n        localStorage.setItem('contact',doctor.contact)\n        localStorage.setItem('isApproved',doctor.isApproved)\n        localStorage.setItem('license',doctor.licenseno)\n        localStorage.setItem('hname',doctor.hname)\n        localStorage.setItem('isdoctor','true')\n\n        console.log(doctor)\n          history.push('/doctor_dashboard')\n        }\n        else{\n          alert(\"Your License is not registered! Please register first to access meDossier.\")\n        }\n        // }\n        \n      }\n      catch(error){\n        console.error(error);\n        // alert(error)\n        alert(\"No records found\")\n      }\n    }\n    else if(result==1){\n      try{\n        console.log(\"sucess\");\n        const patient = await contract.methods.getPatientDetails(currentAccount).call({from:currentAccount});\n\n        setUser(patient);\n        console.log(patient)\n        // if(patient.length!==0){\n          // getPatientRecord();\n         localStorage.setItem('name',patient._name)\n        localStorage.setItem('phone',patient._phone)\n        localStorage.setItem('dob',patient._dob)\n        localStorage.setItem('bloodgroup',patient._bloodgroup)\n        localStorage.setItem('gender',patient._gender)\n        // localStorage.setItem('ispatient','true')\n        localStorage.setItem('ispatient',\"true\")\n\n        \n        // localStorage.setItem('hname',doctor.hname)\n  \n          history.push('/patient')\n        // }\n        \n      }\n      catch(error){\n        console.error(error);\n        // alert(error)\n        alert(\"No records found\")\n      }\n    }\n    else if(result==2) {\n     localStorage.setItem('isUser','true');\n      \n        history.push('/registration')\n  \n    }\n    else{\n      alert(\"User not registered!\")\n    }\n   \n  }\n//Patient grant Access to doctor\n  const grantAccess = async(doctor)=>{\n    try{\n      await contract.methods.grantAccess(doctor).send({from:currentAccount,gas:1000000})\n    }\n    catch(error){\n      console.error(error);\n    }\n  }\n  //Patient revoke access from doctor\n  const revokeAccess = async(doctor)=>{\n    try{\n      console.log(doctor)\n      await contract.methods.revoke_access(doctor).send({from:currentAccount,gas:1000000})\n    }\n    catch(error){\n      console.error(error);\n      alert(error);\n    }\n  }\n\n  const logout=() =>{\n    localStorage.clear()\n    history.push('/')\n    window.location.reload(false);\n  }\n  \n  useEffect(()=>{\n    getWeb3Data();\n  },[]);\n  return (\n    \n      // <div className =\"Main\">\n        <Router history={history}>\n        <Switch>\n          <Route path ='/' exact>\n          <Register\n          patientRegister={patientRegister}\n          doctorRegister ={doctorRegister}\n          handlelogin ={handlelogin}\n\n          />\n          </Route>\n          <Route path ='/patient'>\n            <Patient\n            patient={user}\n            grantAccess ={grantAccess}\n            revokeAccess ={revokeAccess}\n            logout ={logout}\n\n            // getPatientRecord ={getPatientRecord}\n            // records ={records}\n            />\n          </Route>\n          <Route exact path = \"/doctor_dashboard\">\n          <DocDashboard \n          doctor = {user}\n          logout ={logout}\n          currentAccount ={currentAccount}\n          />\n          \n          </Route>\n          <Route exact path = \"/registration\">\n          <Verifier \n          owner = {user}\n          logout ={logout}\n\n          />\n          \n          </Route>\n          \n          </Switch>\n          </Router>\n  \n      // </div>\n    )\n  }\n\nexport default Render"]},"metadata":{},"sourceType":"module"}